<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90-Day Bible Reading Journey (JSONBin Sync)</title>
    <style>
        :root {
            --background: #f8f6f3;
            --text: #2c2c2c;
            --primary: #8b4513;
            --secondary: #cd853f;
            --accent: #daa520;
            --card-bg: #ffffff;
            --border: #e0d4c7;
            --shadow: rgba(139, 69, 19, 0.1);
            --completed: #228b22;
            --current: #ff6b35;
        }

        [data-theme="dark"] {
            --background: #1a1a2e;
            --text: #e6e6e6;
            --primary: #cd853f;
            --secondary: #daa520;
            --accent: #f4a460;
            --card-bg: #16213e;
            --border: #3a3a5c;
            --shadow: rgba(0, 0, 0, 0.4);
            --completed: #32cd32;
            --current: #ff7f50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(218, 165, 32, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            padding: 30px 0;
        }

        .header-title {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px var(--shadow);
            font-weight: bold;
        }

        .header-subtitle {
            font-size: 1.2rem;
            color: var(--secondary);
            font-style: italic;
            margin-bottom: 20px;
        }

        .progress-overview {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .progress-stat {
            text-align: center;
            padding: 15px 25px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            border: 2px solid var(--border);
        }

        .progress-stat h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .progress-stat p {
            color: var(--secondary);
            font-weight: bold;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }

        .reading-plan {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            border: 2px solid var(--border);
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .plan-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: bold;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 15px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .day-card {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow);
            border-color: var(--accent);
        }

        .day-card.completed {
            border-color: var(--completed);
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(34, 139, 34, 0.1) 100%);
        }

        .day-card.current {
            border-color: var(--current);
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255, 107, 53, 0.1) 100%);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .day-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .day-scripture {
            font-size: 1.1rem;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .day-theme {
            font-size: 0.95rem;
            color: var(--secondary);
            font-style: italic;
            margin-bottom: 15px;
        }

        .day-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .read-btn {
            background: var(--primary);
            color: white;
        }

        .read-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .listen-btn {
            background: var(--accent);
            color: white;
        }

        .listen-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .complete-btn {
            background: var(--completed);
            color: white;
        }

        .complete-btn:hover {
            background: #32cd32;
            transform: translateY(-2px);
        }

        .status-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.2rem;
        }

        .audio-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            border: 2px solid var(--border);
            height: fit-content;
        }

        .audio-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .audio-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .current-reading {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .current-reading h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .current-reading p {
            opacity: 0.9;
            font-style: italic;
        }

        .audio-controls {
            margin-bottom: 20px;
        }

        .audio-player {
            width: 100%;
            margin-bottom: 15px;
        }

        .playback-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .control-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .verse-display {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.8;
        }

        .verse-display h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .verse-display p {
            margin-bottom: 10px;
        }

        .verse-display sup {
            color: var(--secondary);
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header-title {
                font-size: 2rem;
            }

            .progress-overview {
                gap: 15px;
            }

            .days-grid {
                grid-template-columns: 1fr;
            }

            .theme-toggle {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">☀️</button>
            <h1 class="header-title">90-Day Bible Reading Journey</h1>
            <p class="header-subtitle">Transform your spiritual life through daily Scripture</p>

            <div class="progress-overview">
                <div class="progress-stat">
                    <h3 id="completedDays">0</h3>
                    <p>Days Completed</p>
                </div>
                <div class="progress-stat">
                    <h3 id="currentDay">1</h3>
                    <p>Current Day</p>
                </div>
                <div class="progress-stat">
                    <h3 id="remainingDays">90</h3>
                    <p>Days Remaining</p>
                </div>
                <div class="progress-stat" id="syncStatus">
                    <h3 id="syncIndicator">📱</h3>
                    <p id="syncText">Local Only</p>
                </div>
            </div>

            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
        </header>

        <div class="main-content">
            <div class="reading-plan">
                <div class="plan-header">
                    <h2 class="plan-title">Daily Readings</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="completed">Completed</button>
                        <button class="filter-btn" data-filter="remaining">Remaining</button>
                    </div>
                </div>

                <div id="daysGrid" class="days-grid">
                    </div>
            </div>

            <div class="audio-panel">
                <div class="audio-header">
                    <h3 class="audio-title">🎵 Scripture Audio</h3>
                    <div style="text-align: center; margin-top: 10px;">
                        <button id="syncButton" class="control-btn" style="font-size: 0.9rem; padding: 5px 15px;">
                            ☁️ Enable Cloud Sync
                        </button>
                    </div>
                </div>

                <div id="currentReading" class="current-reading">
                    <h3>Select a reading</h3>
                    <p>Choose a day to listen to the Scripture</p>
                </div>

                <div class="audio-controls">
                    <audio id="audioPlayer" class="audio-player" controls style="display: none;">
                        Your browser does not support the audio element.
                    </audio>

                    <div class="playback-controls">
                        <button id="playBtn" class="control-btn">▶️ Play</button>
                        <button id="pauseBtn" class="control-btn">⏸️ Pause</button>
                        <button id="stopBtn" class="control-btn">⏹️ Stop</button>
                    </div>
                </div>

                <div id="verseDisplay" class="verse-display">
                    <p>Select a reading to view the scripture text here.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bible reading plan data
        const readingPlan = [
            { day: 1, scripture: "Matthew 6:1–18", theme: "Prayer, fasting, and humility" },
            { day: 2, scripture: "Luke 1:26–38", theme: "Mary's \"Yes\" (The Annunciation)" },
            { day: 3, scripture: "John 2:1–11", theme: "Wedding at Cana" },
            { day: 4, scripture: "Psalm 91", theme: "God's protection over you" },
            { day: 5, scripture: "Mark 5:21–43", theme: "Healing and faith" },
            { day: 6, scripture: "Luke 15:11–32", theme: "The mercy of the Father" },
            { day: 7, scripture: "Luke 18:1–8", theme: "Power of persistent prayer" },
            { day: 8, scripture: "Mark 4:35–41", theme: "Jesus calms your storms" },
            { day: 9, scripture: "Revelation 12:1–17", theme: "The woman clothed with the sun (Mary)" },
            { day: 10, scripture: "Luke 23:33–47", theme: "Jesus' forgiveness from the Cross" },
            { day: 11, scripture: "John 10:1–18", theme: "The Good Shepherd" },
            { day: 12, scripture: "Romans 12:1–21", theme: "A life pleasing to God" },
            { day: 13, scripture: "Psalm 103", theme: "Bless the Lord for His mercy" },
            { day: 14, scripture: "Luke 7:36–50", theme: "A sinful woman forgiven" },
            { day: 15, scripture: "Matthew 9:18–31", theme: "Two healings, one faith" },
            { day: 16, scripture: "Isaiah 58:1–12", theme: "True fasting and its power" },
            { day: 17, scripture: "Psalm 51", theme: "A heart of repentance" },
            { day: 18, scripture: "1 Samuel 1:9–20", theme: "Hannah's prayer and promise" },
            { day: 19, scripture: "Acts 12:1–17", theme: "The power of prayer in crisis" },
            { day: 20, scripture: "Matthew 25:31–46", theme: "Serving Christ in others" },
            { day: 21, scripture: "2 Chronicles 7:12–22", theme: "God's promise to heal the land" },
            { day: 22, scripture: "Matthew 5:1–16", theme: "Beatitudes (true blessing)" },
            { day: 23, scripture: "Exodus 14:10–31", theme: "The Red Sea miracle" },
            { day: 24, scripture: "2 Kings 4:1–7", theme: "God multiplies your little" },
            { day: 25, scripture: "Matthew 8:1–17", theme: "Jesus heals many" },
            { day: 26, scripture: "James 1:2–18", theme: "Trials and perseverance" },
            { day: 27, scripture: "Luke 17:11–19", theme: "The thankful leper" },
            { day: 28, scripture: "Philippians 4:4–13", theme: "Joy and strength in Christ" },
            { day: 29, scripture: "Genesis 22:1–19", theme: "Abraham's obedience" },
            { day: 30, scripture: "Psalm 27", theme: "The Lord is my light" },
            { day: 31, scripture: "Luke 5:1–11", theme: "Peter's calling and surrender" },
            { day: 32, scripture: "Isaiah 40:1–11", theme: "Comfort and hope" },
            { day: 33, scripture: "Matthew 13:1–23", theme: "The parable of the sower" },
            { day: 34, scripture: "Ephesians 6:10–20", theme: "Armor of God" },
            { day: 35, scripture: "Psalm 34", theme: "God hears the brokenhearted" },
            { day: 36, scripture: "Matthew 14:22–33", theme: "Jesus walks on water" },
            { day: 37, scripture: "Daniel 3:1–30", theme: "Fire cannot destroy the faithful" },
            { day: 38, scripture: "Luke 10:38–42", theme: "Mary and Martha" },
            { day: 39, scripture: "John 11:1–44", theme: "The raising of Lazarus" },
            { day: 40, scripture: "Psalm 121", theme: "My help comes from the Lord" },
            { day: 41, scripture: "2 Corinthians 4:7–18", theme: "Treasure in jars of clay" },
            { day: 42, scripture: "John 3:1–21", theme: "Jesus and Nicodemus" },
            { day: 43, scripture: "Matthew 11:25–30", theme: "Rest for the weary" },
            { day: 44, scripture: "Hebrews 11:1–16", theme: "Faith of the ancestors" },
            { day: 45, scripture: "Proverbs 3:1–12", theme: "Trust in the Lord" },
            { day: 46, scripture: "Matthew 7:7–27", theme: "Ask, seek, knock" },
            { day: 47, scripture: "1 Corinthians 13", theme: "The way of love" },
            { day: 48, scripture: "Colossians 3:1–17", theme: "Life in Christ" },
            { day: 49, scripture: "Luke 12:22–34", theme: "Do not worry" },
            { day: 50, scripture: "Psalm 46", theme: "God is our refuge" },
            { day: 51, scripture: "John 15:1–17", theme: "Remain in my love" },
            { day: 52, scripture: "Jeremiah 29:11–14", theme: "Hope and future" },
            { day: 53, scripture: "Mark 10:46–52", theme: "Blind Bartimaeus" },
            { day: 54, scripture: "Deuteronomy 6:1–9", theme: "Love the Lord" },
            { day: 55, scripture: "1 Kings 17:8–16", theme: "The widow's obedience" },
            { day: 56, scripture: "Ecclesiastes 3:1–15", theme: "A time for everything" },
            { day: 57, scripture: "Psalm 42", theme: "My soul thirsts for God" },
            { day: 58, scripture: "Matthew 19:16–30", theme: "The rich young man" },
            { day: 59, scripture: "Genesis 37:1–36", theme: "Joseph's trials begin" },
            { day: 60, scripture: "Genesis 50:15–26", theme: "Forgiveness and restoration" },
            { day: 61, scripture: "Acts 3:1–16", theme: "Healing at the temple gate" },
            { day: 62, scripture: "Job 1", theme: "Faith under testing" },
            { day: 63, scripture: "Job 42", theme: "Restoration after trial" },
            { day: 64, scripture: "Matthew 20:1–16", theme: "God's generous mercy" },
            { day: 65, scripture: "Psalm 139", theme: "God knows you completely" },
            { day: 66, scripture: "Zechariah 9:9–17", theme: "Rejoice, daughter of Zion" },
            { day: 67, scripture: "Matthew 26:36–56", theme: "Gethsemane" },
            { day: 68, scripture: "Luke 22:1–38", theme: "The betrayal foretold" },
            { day: 69, scripture: "John 19:1–30", theme: "The crucifixion" },
            { day: 70, scripture: "John 20:1–29", theme: "The resurrection" },
            { day: 71, scripture: "Luke 24:13–35", theme: "Emmaus encounter" },
            { day: 72, scripture: "Acts 2:1–13", theme: "Pentecost" },
            { day: 73, scripture: "Galatians 5:16–26", theme: "Fruits of the Spirit" },
            { day: 74, scripture: "2 Peter 1:3–11", theme: "Spiritual growth" },
            { day: 75, scripture: "Titus 2:11–15", theme: "Living in grace" },
            { day: 76, scripture: "1 Thessalonians 5:12–28", theme: "Christian living" },
            { day: 77, scripture: "Matthew 6:25–34", theme: "Do not worry about tomorrow" },
            { day: 78, scripture: "Psalm 19", theme: "God's Word is pure" },
            { day: 79, scripture: "Luke 1:46–56", theme: "Mary's Magnificat" },
            { day: 80, scripture: "Exodus 3:1–15", theme: "God calls Moses" },
            { day: 81, scripture: "Joshua 1:1–9", theme: "Be strong and courageous" },
            { day: 82, scripture: "Matthew 16:13–28", theme: "Take up your cross" },
            { day: 83, scripture: "Philippians 2:1–11", theme: "Christ's humility" },
            { day: 84, scripture: "1 John 4:7–21", theme: "God is love" },
            { day: 85, scripture: "John 14:1–14", theme: "Jesus the way" },
            { day: 86, scripture: "Revelation 21:1–8", theme: "A new heaven and earth" },
            { day: 87, scripture: "Psalm 90", theme: "Teach us to number our days" },
            { day: 88, scripture: "Hebrews 4:12–16", theme: "The power of God's Word" },
            { day: 89, scripture: "Romans 8:1–17", theme: "Life in the Spirit" },
            { day: 90, scripture: "Romans 8:18–39", theme: "Nothing can separate you from God's love" }
        ];

        // Application state
        let completedDays = JSON.parse(localStorage.getItem('completedDays') || '[]');
        let currentDayIndex = parseInt(localStorage.getItem('currentDayIndex') || '0');
        let darkMode = JSON.parse(localStorage.getItem('darkMode') || 'false');
        let currentAudioReading = null;

        // Cloud sync configuration (JSONBin.io specific)
        const CLOUD_SYNC = {
            enabled: false,
            provider: 'jsonbin', // Fixed to jsonbin
            lastSync: null,
            syncInProgress: false,
            jsonBinMasterKey: '$2a$10$jYz9hFKgsbjOx/Why3QqWu/jZnNSqJIeXVlb5wJzDveaw2o4Ihbia' // YOUR MASTER KEY HERE
        };

        // DOM elements
        const themeToggle = document.getElementById('themeToggle');
        const daysGrid = document.getElementById('daysGrid');
        const audioPlayer = document.getElementById('audioPlayer');
        const verseDisplay = document.getElementById('verseDisplay');
        const currentReading = document.getElementById('currentReading');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const syncButton = document.getElementById('syncButton'); // Get the sync button

        // Initialize the application
        function init() {
            setupTheme();
            renderDays();
            updateStats();
            setupEventListeners();
            initCloudSync();

            // Load from cloud on startup if enabled
            if (CLOUD_SYNC.enabled) {
                loadFromCloud();
            }
        }

        // --- Core UI and Logic Functions (mostly unchanged) ---

        function setupTheme() {
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '🌙';
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = '☀️';
            }
        }

        function toggleTheme() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', JSON.stringify(darkMode));
            setupTheme();
        }

        function updateStats() {
            const completedCount = completedDays.length;
            const remainingCount = readingPlan.length - completedCount;

            document.getElementById('completedDays').textContent = completedCount;
            document.getElementById('currentDay').textContent = currentDayIndex + 1; // Display 1-based day
            document.getElementById('remainingDays').textContent = remainingCount;

            const progress = (completedCount / readingPlan.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function renderDays(filter = 'all') {
            daysGrid.innerHTML = ''; // Clear existing cards

            readingPlan.forEach((dayData, index) => {
                const day = dayData.day;
                const isCompleted = completedDays.includes(day);
                const isCurrent = (index === currentDayIndex);

                if (filter === 'completed' && !isCompleted) return;
                if (filter === 'remaining' && isCompleted) return;

                const dayCard = document.createElement('div');
                dayCard.classList.add('day-card');
                if (isCompleted) {
                    dayCard.classList.add('completed');
                }
                if (isCurrent && !isCompleted) { // Highlight current day only if not yet completed
                    dayCard.classList.add('current');
                }

                dayCard.dataset.day = day; // Store day number for easy access

                dayCard.innerHTML = `
                    <div class="day-number">Day ${day}</div>
                    <div class="day-scripture">${dayData.scripture}</div>
                    <div class="day-theme">${dayData.theme}</div>
                    <div class="day-actions">
                        <button class="action-btn read-btn" data-day="${day}">Read</button>
                        <button class="action-btn listen-btn" data-day="${day}">Listen</button>
                    </div>
                    ${isCompleted ? '<span class="status-icon">✅</span>' : ''}
                `;
                daysGrid.appendChild(dayCard);

                // Add event listener to mark as complete when a card is clicked (if not already completed)
                dayCard.addEventListener('click', (event) => {
                    if (!event.target.classList.contains('action-btn')) { // Don't toggle if action button clicked
                        toggleDayCompletion(day);
                    }
                });
            });

            // Scroll to current day if not completed and exists
            const currentDayCard = document.querySelector(`.day-card[data-day="${currentDayIndex + 1}"]`);
            if (currentDayCard && !currentDayCard.classList.contains('completed')) {
                currentDayCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function toggleDayCompletion(dayNumber) {
            const index = completedDays.indexOf(dayNumber);
            if (index > -1) {
                // Already completed, unmark it
                completedDays.splice(index, 1);
            } else {
                // Not completed, mark it
                completedDays.push(dayNumber);
                completedDays.sort((a, b) => a - b); // Keep it sorted
                // Move currentDayIndex to the next uncompleted day
                findNextCurrentDay();
            }
            saveProgress();
            renderDays(document.querySelector('.filter-btn.active').dataset.filter); // Re-render with current filter
            updateStats();
            syncWithCloud(); // Sync after state change
        }

        function findNextCurrentDay() {
            let nextDayFound = false;
            for (let i = 0; i < readingPlan.length; i++) {
                const day = readingPlan[i].day;
                if (!completedDays.includes(day)) {
                    currentDayIndex = i;
                    nextDayFound = true;
                    break;
                }
            }
            if (!nextDayFound) {
                currentDayIndex = readingPlan.length - 1; // All days completed, stay on last day
            }
        }

        function saveProgress() {
            localStorage.setItem('completedDays', JSON.stringify(completedDays));
            localStorage.setItem('currentDayIndex', currentDayIndex.toString());
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            themeToggle.addEventListener('click', toggleTheme);

            daysGrid.addEventListener('click', (event) => {
                const dayBtn = event.target.closest('.action-btn');
                if (dayBtn) {
                    const day = parseInt(dayBtn.dataset.day);
                    const dayData = readingPlan[day - 1]; // day - 1 because array is 0-indexed

                    if (dayBtn.classList.contains('read-btn')) {
                        displayScriptureText(dayData.scripture);
                        highlightCurrentReading(dayData);
                    } else if (dayBtn.classList.contains('listen-btn')) {
                        // In a real app, you'd have audio files.
                        // For demonstration, we'll just display a message.
                        alert(`Listening to: ${dayData.scripture}\n(Audio functionality not implemented in this demo)`);
                        // Example: loadAudio(`audio/${dayData.scripture.replace(/ /g, '_')}.mp3`);
                        highlightCurrentReading(dayData);
                    }
                }
            });

            filterBtns.forEach(button => {
                button.addEventListener('click', () => {
                    filterBtns.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    renderDays(button.dataset.filter);
                });
            });

            // Audio control buttons
            playBtn.addEventListener('click', () => {
                if (audioPlayer.src) audioPlayer.play();
            });
            pauseBtn.addEventListener('click', () => {
                if (audioPlayer.src) audioPlayer.pause();
            });
            stopBtn.addEventListener('click', () => {
                if (audioPlayer.src) {
                    audioPlayer.pause();
                    audioPlayer.currentTime = 0;
                }
            });

            // Sync button listener
            syncButton.addEventListener('click', () => {
                if (!CLOUD_SYNC.enabled) {
                    enableSimpleCloudSync();
                } else {
                    syncWithCloud();
                }
            });
        }

        function displayScriptureText(scriptureRef) {
            // This is a placeholder. In a real app, you'd fetch the actual scripture text.
            verseDisplay.innerHTML = `<h4>${scriptureRef}</h4><p>This is where the scripture text for ${scriptureRef} would appear. For a full implementation, you would integrate with a Bible API (e.g., ESV API, Bible Gateway API) or include the text directly.</p><p>For example, you could dynamically fetch: <code>fetch('https://api.esv.org/v2/rest/passage?q=${encodeURIComponent(scriptureRef)}')</code></p>`;
        }

        function highlightCurrentReading(dayData) {
            currentReading.innerHTML = `
                <h3>Day ${dayData.day}: ${dayData.scripture}</h3>
                <p>${dayData.theme}</p>
            `;
            // Show audio player if there was an actual audio source
            audioPlayer.style.display = 'block';
            // audioPlayer.src = `path/to/audio/${dayData.day}.mp3`; // This would be the actual audio source
            audioPlayer.src = ''; // Clear source for demo, as no audio is linked
        }

        // --- JSONBin.io Cloud Sync Functions ---

        function initCloudSync() {
            const savedSyncSettings = JSON.parse(localStorage.getItem('cloudSyncSettings') || '{}');
            const savedCloudBinId = localStorage.getItem('cloudSyncId');
            const savedCloudUserId = localStorage.getItem('cloudUserId');

            if (savedSyncSettings.enabled && savedSyncSettings.provider === 'jsonbin' && savedCloudBinId && savedCloudUserId) {
                CLOUD_SYNC.enabled = true;
                CLOUD_SYNC.lastSync = savedSyncSettings.lastSync;
                updateSyncStatus();
            }
        }

        function updateSyncStatus() {
            const syncIndicator = document.getElementById('syncIndicator');
            const syncText = document.getElementById('syncText');
            const syncButton = document.getElementById('syncButton');

            if (CLOUD_SYNC.enabled) {
                syncIndicator.textContent = CLOUD_SYNC.syncInProgress ? '🔄' : '☁️';
                syncText.textContent = CLOUD_SYNC.syncInProgress ? 'Syncing...' : 'Cloud Synced';
                syncButton.textContent = '☁️ Sync Now';
                syncButton.style.background = 'var(--completed)';
            } else {
                syncIndicator.textContent = '📱';
                syncText.textContent = 'Local Only';
                syncButton.textContent = '☁️ Enable Cloud Sync';
                syncButton.style.background = 'var(--secondary)';
            }

            if (CLOUD_SYNC.enabled && CLOUD_SYNC.lastSync) {
                const lastSyncDate = new Date(CLOUD_SYNC.lastSync).toLocaleString();
                syncText.textContent += ` (Last: ${lastSyncDate})`;
            }
        }

        // Enable Simple Cloud Sync (JSONBin.io) - For initial setup or re-enabling
        async function enableSimpleCloudSync() {
            const userIdPrompt = prompt('Enter a unique User ID for syncing (this will be your sync key across devices).\n\nIf you have synced before, enter your existing User ID to retrieve your data. Otherwise, enter a new one.');

            if (!userIdPrompt || userIdPrompt.trim() === '') {
                alert('❌ User ID is required for cloud sync.');
                return;
            }
            const userId = userIdPrompt.trim();

            CLOUD_SYNC.syncInProgress = true;
            updateSyncStatus();

            try {
                // 1. Try to find an existing bin for this userId
                const searchResponse = await fetch(`https://api.jsonbin.io/v3/c/669d5f70e41b4d34e414168c/find-one`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CLOUD_SYNC.jsonBinMasterKey
                    },
                    body: JSON.stringify({ userId: userId })
                });

                if (searchResponse.ok) {
                    const searchData = await searchResponse.json();
                    if (searchData.record && searchData.metadata && searchData.metadata.id) {
                        // Found existing bin for this user
                        const binId = searchData.metadata.id;
                        localStorage.setItem('cloudSyncId', binId);
                        localStorage.setItem('cloudUserId', userId);

                        CLOUD_SYNC.enabled = true;
                        saveSyncSettings();
                        updateSyncStatus();

                        alert(`✅ Cloud sync enabled! Existing data for User ID "${userId}" found and will be loaded.`);
                        await loadFromCloud(); // Load the found data
                        return;
                    }
                } else if (searchResponse.status === 404) {
                    // No existing bin found, proceed to create a new one
                    console.log(`No existing bin for User ID "${userId}". Creating a new one...`);
                } else {
                    const errorSearchText = await searchResponse.text();
                    console.error('JSONBin search error:', searchResponse.status, errorSearchText);
                    throw new Error(`Failed to search for existing data: ${searchResponse.statusText}`);
                }

                // 2. If no existing bin, create a new one
                const createResponse = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CLOUD_SYNC.jsonBinMasterKey,
                        'X-Bin-Name': `BibleJourney_${userId}` // Optional: give it a readable name
                    },
                    body: JSON.stringify({
                        userId: userId,
                        completedDays: [], // Start with empty if new
                        currentDayIndex: 0, // Start from day 0 if new
                        lastUpdated: new Date().toISOString()
                    })
                });

                if (createResponse.ok) {
                    const data = await createResponse.json();
                    localStorage.setItem('cloudSyncId', data.metadata.id);
                    localStorage.setItem('cloudUserId', userId);

                    CLOUD_SYNC.enabled = true;
                    saveSyncSettings();
                    updateSyncStatus();

                    alert(`✅ Cloud sync enabled! New sync ID created for user "${userId}".\nYour local progress will now be saved to the cloud.`);
                    await syncWithCloud(); // Immediately save local progress to the new bin
                } else {
                    const errorCreateText = await createResponse.text();
                    console.error('JSONBin create error:', createResponse.status, errorCreateText);
                    throw new Error(`Failed to create cloud storage: ${createResponse.statusText}`);
                }
            } catch (error) {
                console.error('Simple cloud sync error:', error);
                alert('❌ Failed to enable simple cloud sync. Please check your internet connection and console for details.');
            } finally {
                CLOUD_SYNC.syncInProgress = false;
                updateSyncStatus();
            }
        }


        // Save sync settings (just local to the browser for CLOUD_SYNC.enabled state)
        function saveSyncSettings() {
            localStorage.setItem('cloudSyncSettings', JSON.stringify({
                enabled: CLOUD_SYNC.enabled,
                provider: CLOUD_SYNC.provider,
                lastSync: CLOUD_SYNC.lastSync
            }));
        }

        // Sync with cloud (main function)
        async function syncWithCloud() {
            if (!CLOUD_SYNC.enabled) {
                console.log('Cloud sync is not enabled. Skipping sync operation.');
                return;
            }

            CLOUD_SYNC.syncInProgress = true;
            updateSyncStatus();
            let success = false;

            try {
                await syncWithJSONBin(); // Call the specific JSONBin.io sync function
                CLOUD_SYNC.lastSync = new Date().toISOString();
                saveSyncSettings();
                success = true;
                console.log('Cloud sync complete.');
            } catch (error) {
                console.error('Sync failed:', error);
                alert('⚠️ Sync failed. Your progress is still saved locally. Check console for details.');
            } finally {
                CLOUD_SYNC.syncInProgress = false;
                updateSyncStatus();
                if (success) {
                    // brief visual confirmation of sync
                    const syncIndicator = document.getElementById('syncIndicator');
                    syncIndicator.textContent = '✅';
                    setTimeout(() => updateSyncStatus(), 1500); // Revert after 1.5 seconds
                }
            }
        }

        // JSONBin.io specific sync implementation
        async function syncWithJSONBin() {
            const BIN_ID = localStorage.getItem('cloudSyncId');
            const cloudUserId = localStorage.getItem('cloudUserId');

            if (!BIN_ID || !cloudUserId) {
                console.warn('JSONBin sync skipped: No cloudSyncId or cloudUserId found.');
                CLOUD_SYNC.enabled = false; // Disable sync if ID is missing
                saveSyncSettings();
                return;
            }

            try {
                // Data to be saved to the cloud (local state is the source of truth for saving)
                const dataToSave = {
                    userId: cloudUserId,
                    completedDays: completedDays,
                    currentDayIndex: currentDayIndex,
                    lastUpdated: new Date().toISOString()
                };

                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT', // Use PUT to update an existing bin
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CLOUD_SYNC.jsonBinMasterKey,
                        'X-Bin-Private': 'true' // Keep your bin private
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('JSONBin update error:', response.status, errorText);
                    throw new Error(`Failed to update JSONBin data: ${response.statusText}`);
                }

                console.log('✅ Data successfully updated on JSONBin.io');

            } catch (error) {
                console.error('Error during JSONBin sync:', error);
                throw error; // Re-throw to be caught by the main syncWithCloud function
            }
        }

        // Load data from JSONBin.io
        async function loadFromCloud() {
            if (!CLOUD_SYNC.enabled) {
                console.log('Cloud sync is not enabled. Skipping cloud data load.');
                return;
            }

            const BIN_ID = localStorage.getItem('cloudSyncId');
            if (!BIN_ID) {
                console.warn('Cannot load from JSONBin: No cloudSyncId found.');
                return;
            }

            CLOUD_SYNC.syncInProgress = true;
            updateSyncStatus();

            try {
                console.log('Attempting to load data from JSONBin.io...');
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': CLOUD_SYNC.jsonBinMasterKey,
                        'X-Bin-Meta': 'false' // To get only the data payload
                    }
                });

                if (response.ok) {
                    const cloudData = await response.json();
                    if (cloudData) {
                        // Apply loaded data to your app state
                        completedDays = Array.isArray(cloudData.completedDays) ? cloudData.completedDays : [];
                        currentDayIndex = typeof cloudData.currentDayIndex === 'number' ? cloudData.currentDayIndex : 0;

                        // Save loaded data to local storage
                        localStorage.setItem('completedDays', JSON.stringify(completedDays));
                        localStorage.setItem('currentDayIndex', currentDayIndex.toString());

                        renderDays(document.querySelector('.filter-btn.active').dataset.filter); // Re-render the UI
                        updateStats(); // Update progress stats
                        console.log('✅ Data loaded from JSONBin.io successfully.');
                        alert('Your progress has been loaded from the cloud!');
                    }
                } else if (response.status === 404) {
                    console.warn(`JSONBin ID ${BIN_ID} not found. Could be deleted or incorrect. Attempting to re-enable.`);
                    alert('Cloud data not found. Please try enabling sync again with your User ID.');
                    CLOUD_SYNC.enabled = false;
                    localStorage.removeItem('cloudSyncId');
                    localStorage.removeItem('cloudUserId');
                    saveSyncSettings();
                }
                else {
                    const errorText = await response.text();
                    console.error('Failed to load from JSONBin.io, response:', response.status, errorText);
                    throw new Error(`Failed to load cloud data: ${response.statusText}`);
                }
            } catch (error) {
                console.error('JSONBin load error:', error);
                alert('⚠️ Failed to load progress from cloud. Using local data.');
            } finally {
                CLOUD_SYNC.syncInProgress = false;
                updateSyncStatus();
            }
        }


        // --- Initialize the App ---
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
